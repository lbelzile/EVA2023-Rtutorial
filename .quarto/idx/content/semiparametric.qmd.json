{"title":"Semiparametric methods and Hill estimation","markdown":{"yaml":{"title":"Semiparametric methods and Hill estimation","page-layout":"full","title-block-banner":false,"cache":true},"headingText":"Threshold selection for Hill's estimator","containsRefs":false,"markdown":"\n\nThere are multiple alternative estimators of the shape parameter for heavy-tailed data, the most popular of which is the @Hill:1975 estimator . Consider a random sample of order statistics $Y_{(1)} > \\cdots > Y_{(n)}$. The latter is, for exceedances above $Y_{(n-k)} >0$, \n\\begin{align}\n H_{n,k}(\\boldsymbol{Y}) = \\frac{1}{k}\\sum_{i=n-k+1}^{n} \\log Y_{(i)} - \\log Y_{(n-k)}, \\qquad (j=1, 2), \\label{eq:Hillest}\n\\end{align}\n\nUnder a second order regular variation assumption and provided $\\lim_{k \\to \\infty} k^{1/2}A(n/k) = \\lambda\\in \\mathbb{R}$, Hill's estimator is asymptotically normal \\citep[Theorem 3.2.5][]{deHaan.Ferreira:2006} with \n\\begin{align*}\nk^{1/2}(H_{n,k} - \\xi) \\to \\mathsf{No}\\{\\lambda/(1-\\rho), \\xi^2\\}, \\qquad \\xi>0, \\rho \\leq 0;\n\\end{align*} the asymptotic bias term is dictated by the rate at which the number of extreme observations grows relative to the total sample size and  depends on the unknown second-order auxiliary function $A(\\cdot)$ which is distribution-specific. The estimator is consistent for $\\xi$  provided $k=k(n)$ is an intermediate sequence satisfying $k/n \\to 0$ as $k, n \\to \\infty$ such that $\\lambda \\to 0$. Note the asymptotic variance, to be constrasted with that of the maximum likelihood estimator of the shape for the  generalized Pareto shape, which is $(1+\\xi)^2$.\n\n\n```{r}\n#| message: false\ndata(frwind, package = \"mev\")\nlyon <- sort(frwind$S2, decreasing = TRUE)\nremotes::install_github(\"lbelzile/rbm\", quiet = TRUE)\n# Fit Hill's estimator\nhill_est <- rbm::hill(data_array = lyon,\n                      idx = 1:400)\nplot(hill_est)\n```\n\nWe can see that the Hill estimator values are quite stable (which is seldom the case) and however around 0.1. However, maximum likelihood estimators of the shape parameter $\\xi$ are much closer to zero and negative for other wind speed series. The noticeable tilted staircase pattern is an artefact of rounding.\n\n\nA simple graphical method for choosing the number of order statistics to keep is a plot of the rank against shape parameters, termed Hill plots. Practical recommendations are that (1) the number of order statistics should be restricted (say 20 to 500), (2) the graph is more easily interpreted when the $x$-axis shows normalized log ranks $\\log(k)/\\log(n)$, and (3) parameters should be smoothed using a moving window estimator, as the sample path of the Hill estimator are analogous to a Brownian motion.\n\nNote that Hill estimator is not location invariant. The pointwise confidence intervals reported by must methods are based on exact Pareto tails, so are at best approximate.\n\n```{r}\nevmix::hillplot(data = lyon[1:300],\n                hill.type = \"SmooHill\", \n                r = 3L, \n                x.theta = TRUE)\n```\n\n\nThere are multiple alternative estimators of the shape parameter: extensive simulation studies show that the threshold selection performance using the random block maxima estimator of @Wager:2014 is competitive. The latter is a $U$ statistic and has $\\mathcal{C}^{\\infty}$ sample paths: the selection is based on empirical risk minimization  using a finite-difference approximation to the squared derivative of the process, subject to a penalty\nterm. Although the computational cost is higher than Hill’s estimator, it can be kept reasonable by restricting attention to only largest exceedances.\n\n```{r}\nrbm_est <- rbm::rbm.point_estimate(lyon[1:300])\nplot <- rbm::rbm.plot(lyon[1:300])\n````\nOther threshold selection methods, including the minimization of the asymptotic mean squared error of the Hill estimator highlighted in Section 2 of @Caeiro.Gomes:2016, also works well but can fail catastrophically in some settings. Here, the answer (in terms of the tail index $\\alpha=1/\\xi$), is similar to other packages\n\n```{r}\nest_AMSE <- tea::dAMSE(lyon[1:300])\n```\n\nMany such estimators are available from the `tea` package. Extensions that deal with censoring and conditional estimators (`ReIns`), time series (`extremefit`), etc. but we will not attempt to cover those.\n\n## Quantile estimator\n\nGiven an estimate of a positive shape parameter, we can get quantile estimates through @Weissman:1978 formula. The estimator of the quantile at level $1-p$, for small $p$, is\n\\begin{align*}\nQ^W_{k,n}(1-p) = Y_{(n-k)} \\left\\{ \\frac{k+1}{p(n+1)} \\right\\}^{H_{k,n}},                                                                     \\end{align*}\nwhere $H_{k,n}$ is the Hill estimator of the shape parameter and $Y_{(n-k)}$ is the $(n-k)$th order statistic, acting as threshold. While there are software that return these quantities, including the `ReIns`, `evt0` and `extremefit` packages, they are easily coded.\n\n\nBelow, we show how to estimate the 0.999 quantile of the distribution by extrapolating the shape\n```{r}\nqweissman <- function(n, p, k, thresh, shape){\n  thresh * ((k + 1) / (1 - p)/ (n + 1))^shape\n}\nquants <- qweissman(n = length(lyon), \n          p = seq(0.99, 0.999, length.out = 101), \n          thresh = est_AMSE$threshold,\n          k = est_AMSE$k0, \n          shape = 1/est_AMSE$tail.index)\n```\n\nUncertainty statements, if any, could be obtained by bootstrap methods or using asymptotic normality, but given the sampling distribution of the quantile estimator is strongly asymmetric, Wald-type (symmetric) confidence intervals are bound to give poor coverage.\n","srcMarkdownNoYaml":"\n\nThere are multiple alternative estimators of the shape parameter for heavy-tailed data, the most popular of which is the @Hill:1975 estimator . Consider a random sample of order statistics $Y_{(1)} > \\cdots > Y_{(n)}$. The latter is, for exceedances above $Y_{(n-k)} >0$, \n\\begin{align}\n H_{n,k}(\\boldsymbol{Y}) = \\frac{1}{k}\\sum_{i=n-k+1}^{n} \\log Y_{(i)} - \\log Y_{(n-k)}, \\qquad (j=1, 2), \\label{eq:Hillest}\n\\end{align}\n\nUnder a second order regular variation assumption and provided $\\lim_{k \\to \\infty} k^{1/2}A(n/k) = \\lambda\\in \\mathbb{R}$, Hill's estimator is asymptotically normal \\citep[Theorem 3.2.5][]{deHaan.Ferreira:2006} with \n\\begin{align*}\nk^{1/2}(H_{n,k} - \\xi) \\to \\mathsf{No}\\{\\lambda/(1-\\rho), \\xi^2\\}, \\qquad \\xi>0, \\rho \\leq 0;\n\\end{align*} the asymptotic bias term is dictated by the rate at which the number of extreme observations grows relative to the total sample size and  depends on the unknown second-order auxiliary function $A(\\cdot)$ which is distribution-specific. The estimator is consistent for $\\xi$  provided $k=k(n)$ is an intermediate sequence satisfying $k/n \\to 0$ as $k, n \\to \\infty$ such that $\\lambda \\to 0$. Note the asymptotic variance, to be constrasted with that of the maximum likelihood estimator of the shape for the  generalized Pareto shape, which is $(1+\\xi)^2$.\n\n## Threshold selection for Hill's estimator\n\n```{r}\n#| message: false\ndata(frwind, package = \"mev\")\nlyon <- sort(frwind$S2, decreasing = TRUE)\nremotes::install_github(\"lbelzile/rbm\", quiet = TRUE)\n# Fit Hill's estimator\nhill_est <- rbm::hill(data_array = lyon,\n                      idx = 1:400)\nplot(hill_est)\n```\n\nWe can see that the Hill estimator values are quite stable (which is seldom the case) and however around 0.1. However, maximum likelihood estimators of the shape parameter $\\xi$ are much closer to zero and negative for other wind speed series. The noticeable tilted staircase pattern is an artefact of rounding.\n\n\nA simple graphical method for choosing the number of order statistics to keep is a plot of the rank against shape parameters, termed Hill plots. Practical recommendations are that (1) the number of order statistics should be restricted (say 20 to 500), (2) the graph is more easily interpreted when the $x$-axis shows normalized log ranks $\\log(k)/\\log(n)$, and (3) parameters should be smoothed using a moving window estimator, as the sample path of the Hill estimator are analogous to a Brownian motion.\n\nNote that Hill estimator is not location invariant. The pointwise confidence intervals reported by must methods are based on exact Pareto tails, so are at best approximate.\n\n```{r}\nevmix::hillplot(data = lyon[1:300],\n                hill.type = \"SmooHill\", \n                r = 3L, \n                x.theta = TRUE)\n```\n\n\nThere are multiple alternative estimators of the shape parameter: extensive simulation studies show that the threshold selection performance using the random block maxima estimator of @Wager:2014 is competitive. The latter is a $U$ statistic and has $\\mathcal{C}^{\\infty}$ sample paths: the selection is based on empirical risk minimization  using a finite-difference approximation to the squared derivative of the process, subject to a penalty\nterm. Although the computational cost is higher than Hill’s estimator, it can be kept reasonable by restricting attention to only largest exceedances.\n\n```{r}\nrbm_est <- rbm::rbm.point_estimate(lyon[1:300])\nplot <- rbm::rbm.plot(lyon[1:300])\n````\nOther threshold selection methods, including the minimization of the asymptotic mean squared error of the Hill estimator highlighted in Section 2 of @Caeiro.Gomes:2016, also works well but can fail catastrophically in some settings. Here, the answer (in terms of the tail index $\\alpha=1/\\xi$), is similar to other packages\n\n```{r}\nest_AMSE <- tea::dAMSE(lyon[1:300])\n```\n\nMany such estimators are available from the `tea` package. Extensions that deal with censoring and conditional estimators (`ReIns`), time series (`extremefit`), etc. but we will not attempt to cover those.\n\n## Quantile estimator\n\nGiven an estimate of a positive shape parameter, we can get quantile estimates through @Weissman:1978 formula. The estimator of the quantile at level $1-p$, for small $p$, is\n\\begin{align*}\nQ^W_{k,n}(1-p) = Y_{(n-k)} \\left\\{ \\frac{k+1}{p(n+1)} \\right\\}^{H_{k,n}},                                                                     \\end{align*}\nwhere $H_{k,n}$ is the Hill estimator of the shape parameter and $Y_{(n-k)}$ is the $(n-k)$th order statistic, acting as threshold. While there are software that return these quantities, including the `ReIns`, `evt0` and `extremefit` packages, they are easily coded.\n\n\nBelow, we show how to estimate the 0.999 quantile of the distribution by extrapolating the shape\n```{r}\nqweissman <- function(n, p, k, thresh, shape){\n  thresh * ((k + 1) / (1 - p)/ (n + 1))^shape\n}\nquants <- qweissman(n = length(lyon), \n          p = seq(0.99, 0.999, length.out = 101), \n          thresh = est_AMSE$threshold,\n          k = est_AMSE$k0, \n          shape = 1/est_AMSE$tail.index)\n```\n\nUncertainty statements, if any, could be obtained by bootstrap methods or using asymptotic normality, but given the sampling distribution of the quantile estimator is strongly asymmetric, Wald-type (symmetric) confidence intervals are bound to give poor coverage.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":true,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"semiparametric.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.361","url":"https://lbelzile.github.io/EVA2023-tutorial","bibliography":["../files/bib/vignette.bib"],"csl":"../files/bib/apa.csl","theme":["litera","../html/custom.scss"],"title":"Semiparametric methods and Hill estimation","page-layout":"full","title-block-banner":false},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}